# Supabase Yapılandırma Rehberi

## Adım 1: Supabase Projesi Oluştur

1. [Supabase](https://supabase.com)'a gidin ve hesap oluşturun
2. "New Project" butonuna tıklayın
3. Proje bilgilerini girin:
   - **Organization:** Kuruluş adı
   - **Name:** Panel-1
   - **Database Password:** Güçlü bir şifre (not edin)
   - **Region:** En yakın bölgeyi seçin (örn: eu-west-1)

## Adım 2: Proje URL ve Anon Key Alın

Proje oluşturulduktan sonra:

1. Projenizin **Settings** > **API** sayfasına gidin
2. Aşağıdaki bilgileri kopyalayın:
   - **Project URL:** `https://xxxxxxxxxxxxx.supabase.co`
   - **anon public key:** `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...`

## Adım 3: .env.local Dosyasını Oluşturun

Proje kök dizininde `.env.local` dosyası oluşturun (bu dosya .gitignore'da olduğu için git'e eklenmez):

```bash
# .env.local dosyasını oluşturun
cp .env.example .env.local
```

Sonra `.env.local` dosyasını düzenleyin:

```env
NEXT_PUBLIC_SUPABASE_URL=https://xxxxxxxxxxxxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

## Adım 4: Veritabanı Şemasını Oluşturun

Supabase dashboard'da **SQL Editor**'u açın ve aşağıdaki SQL komutlarını çalıştırın:

```sql
-- Üyeler Tablosu
CREATE TABLE IF NOT EXISTS members (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  tc_kimlik_no VARCHAR(11) UNIQUE NOT NULL,
  ad VARCHAR(100) NOT NULL,
  soyad VARCHAR(100) NOT NULL,
  dogum_tarihi DATE,
  cinsiyet VARCHAR(20),
  telefon VARCHAR(20),
  email VARCHAR(255),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Bağışlar Tablosu
CREATE TABLE IF NOT EXISTS donations (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  member_id BIGINT REFERENCES members(id),
  bagisci_adi VARCHAR(200),
  tutar DECIMAL(10,2) NOT NULL,
  currency VARCHAR(3) DEFAULT 'TRY',
  amac VARCHAR(50),
  odeme_yontemi VARCHAR(50),
  makbuz_no VARCHAR(100),
  aciklama TEXT,
  fatura_url TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- İhtiyaç Sahipleri Tablosu
CREATE TABLE IF NOT EXISTS beneficiaries (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  ad VARCHAR(100) NOT NULL,
  soyad VARCHAR(100) NOT NULL,
  tc_kimlik_no VARCHAR(11),
  relationship_type VARCHAR(50),
  kategori VARCHAR(50),
  dogum_tarihi DATE,
  cinsiyet VARCHAR(20),
  telefon VARCHAR(20),
  email VARCHAR(255),
  adres TEXT,
  il VARCHAR(100),
  ilce VARCHAR(100),
  mahalle VARCHAR(100),
  engelli_durumu BOOLEAN DEFAULT FALSE,
  engelli_raporu_url TEXT,
  kronik_hastalik_durumu BOOLEAN DEFAULT FALSE,
  kronik_hastalik_raporu_url TEXT,
  egitim_durumu VARCHAR(50),
  meslek VARCHAR(100),
  gelir_durumu VARCHAR(50),
  hane_geliri DECIMAL(10,2),
  mal_varligi TEXT,
  kira_durumu BOOLEAN DEFAULT FALSE,
  ev_kira_bedeli DECIMAL(10,2),
  is_gecmisi TEXT,
  sosyal_yardim_gecmisi TEXT,
  medeni_durum VARCHAR(50),
  cocuk_sayisi INTEGER DEFAULT 0,
  hane_halki_buyuk_sayisi INTEGER DEFAULT 0,
  hane_halki_cocuk_sayisi INTEGER DEFAULT 0,
  fotograf_url TEXT,
  kimlik_belgesi_url TEXT,
  ikametgah_belgesi_url TEXT,
  aile_durum_belgesi_url TEXT,
  gelir_belgesi_url TEXT,
  tapu_belgesi_url TEXT,
  arac_ruhsat_belgesi_url TEXT,
  fatura_belgesi_url TEXT,
  banka_hesap_bilgileri TEXT,
  notlar TEXT,
  ihtiyac_durumu VARCHAR(20) DEFAULT 'dusuk',
  sponsorluk_turu VARCHAR(50),
  durum VARCHAR(20) DEFAULT 'pasif',
  riza_beyani_durumu BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Sosyal Yardım Başvuruları Tablosu
CREATE TABLE IF NOT EXISTS social_aid_applications (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  beneficiary_id BIGINT REFERENCES beneficiaries(id),
  yardim_turu VARCHAR(50),
  talep_edilen_tutar DECIMAL(10,2),
  gerekce TEXT,
  durum VARCHAR(20) DEFAULT 'beklemede',
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Kumbaralar Tablosu
CREATE TABLE IF NOT EXISTS kumbaras (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  kod VARCHAR(50) UNIQUE NOT NULL,
  konum TEXT,
  sorumlu_id BIGINT,
  durum VARCHAR(20) DEFAULT 'aktif',
  notlar TEXT,
  son_toplama_tarihi DATE,
  toplam_toplanan DECIMAL(10,2) DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Index'ler
CREATE INDEX IF NOT EXISTS idx_members_tc_kimlik ON members(tc_kimlik_no);
CREATE INDEX IF NOT EXISTS idx_donations_member_id ON donations(member_id);
CREATE INDEX IF NOT EXISTS idx_beneficiaries_tc_kimlik ON beneficiaries(tc_kimlik_no);
CREATE INDEX IF NOT EXISTS idx_social_aid_beneficiary_id ON social_aid_applications(beneficiary_id);
CREATE INDEX IF NOT EXISTS idx_kumbaras_kod ON kumbaras(kod);
```

## Adım 5: Row Level Security (RLS) Ayarları

Güvenlik için RLS'i etkinleştirin:

```sql
-- RLS'i etkinleştir
ALTER TABLE members ENABLE ROW LEVEL SECURITY;
ALTER TABLE donations ENABLE ROW LEVEL SECURITY;
ALTER TABLE beneficiaries ENABLE ROW LEVEL SECURITY;
ALTER TABLE social_aid_applications ENABLE ROW LEVEL SECURITY;
ALTER TABLE kumbaras ENABLE ROW LEVEL SECURITY;

-- Herkese okuma izni (development için)
CREATE POLICY "Public read access" ON members FOR SELECT USING (true);
CREATE POLICY "Public read access" ON donations FOR SELECT USING (true);
CREATE POLICY "Public read access" ON beneficiaries FOR SELECT USING (true);
CREATE POLICY "Public read access" ON social_aid_applications FOR SELECT USING (true);
CREATE POLICY "Public read access" ON kumbaras FOR SELECT USING (true);

-- Authentication gerektiren yazma izinleri
CREATE POLICY "Authenticated insert" ON members FOR INSERT WITH CHECK (auth.role() = 'authenticated');
CREATE POLICY "Authenticated update" ON members FOR UPDATE USING (auth.role() = 'authenticated');
CREATE POLICY "Authenticated delete" ON members FOR DELETE USING (auth.role() = 'authenticated');

CREATE POLICY "Authenticated insert" ON donations FOR INSERT WITH CHECK (auth.role() = 'authenticated');
CREATE POLICY "Authenticated update" ON donations FOR UPDATE USING (auth.role() = 'authenticated');
CREATE POLICY "Authenticated delete" ON donations FOR DELETE USING (auth.role() = 'authenticated');

CREATE POLICY "Authenticated insert" ON beneficiaries FOR INSERT WITH CHECK (auth.role() = 'authenticated');
CREATE POLICY "Authenticated update" ON beneficiaries FOR UPDATE USING (auth.role() = 'authenticated');
CREATE POLICY "Authenticated delete" ON beneficiaries FOR DELETE USING (auth.role() = 'authenticated');

CREATE POLICY "Authenticated insert" ON social_aid_applications FOR INSERT WITH CHECK (auth.role() = 'authenticated');
CREATE POLICY "Authenticated update" ON social_aid_applications FOR UPDATE USING (auth.role() = 'authenticated');
CREATE POLICY "Authenticated delete" ON social_aid_applications FOR DELETE USING (auth.role() = 'authenticated');

CREATE POLICY "Authenticated insert" ON kumbaras FOR INSERT WITH CHECK (auth.role() = 'authenticated');
CREATE POLICY "Authenticated update" ON kumbaras FOR UPDATE USING (auth.role() = 'authenticated');
CREATE POLICY "Authenticated delete" ON kumbaras FOR DELETE USING (auth.role() = 'authenticated');
```

## Adım 6: Test Verisi Ekleyin (Opsiyonel)

Test için örnek veriler:

```sql
-- Örnek üye
INSERT INTO members (tc_kimlik_no, ad, soyad, cinsiyet, telefon) 
VALUES ('12345678901', 'Ahmet', 'Yılmaz', 'erkek', '+905551234567');

-- Örnek bağış
INSERT INTO donations (member_id, bagisci_adi, tutar, amac) 
VALUES (1, 'Ahmet Yılmaz', 1000.00, 'genel');

-- Örnek ihtiyaç sahibi
INSERT INTO beneficiaries (ad, soyad, tc_kimlik_no, telefon, durum) 
VALUES ('Fatma', 'Demir', '98765432109', '+905559876543', 'aktif');
```

## Adım 7: Development Server'ı Yeniden Başlatın

```bash
# Terminal'de Ctrl+C ile durdurun
# Sonra tekrar başlatın
npm run dev
```

## Adım 8: Bağlantıyı Test Edin

Tarayıcıda http://localhost:3000 adresine gidin ve uygulamanın Supabase ile haberleştiğini doğrulayın.

---

## Sorun Giderme

### "Connection refused" Hatası
- Supabase URL'sinin doğru olduğundan emin olun
- Anon key'in doğru kopyalandığından emin olun
- .env.local dosyasının proje kök dizininde olduğundan emin olun

### "Permission denied" Hatası
- RLS politikalarının doğru ayarlandığından emin olun
- SQL Editor'da politikaları kontrol edin

### "Table not found" Hatası
- SQL komutlarının çalıştırıldığından emin olun
- Tablo adlarının doğru olduğundan emin olun

---

## Sonraki Adımlar

1. Authentication (Giriş/Kayıt) sistemini yapılandırın
2. Storage bucket'ları oluşturun (dosya yükleme için)
3. Realtime subscriptions'ı etkinleştirin (gerçek zamanlı güncellemeler için)
4. Edge Functions'ları oluşturun (sunucu tarafı mantık için)

---

## Faydalı Kaynaklar

- [Supabase Dokümantasyonu](https://supabase.com/docs)
- [Supabase TypeScript Client](https://supabase.com/docs/reference/javascript)
- [Row Level Security Guide](https://supabase.com/docs/guides/auth/row-level-security)
- [Storage Guide](https://supabase.com/docs/guides/storage)
